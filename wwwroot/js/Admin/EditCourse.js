// EditCourse.js
console.log("EditCourse.js loaded");

(function () {
    const form = document.getElementById('editCourseForm');
    if (!form) {
        console.log("editCourseForm not found");
        return;
    }

    // Progressive enhancement:
    // By default, the form will POST normally and the server (controller) saves to DB.
    // Optional: if you prefer AJAX submit, uncomment the code below.
    //
    // NOTE: AJAX must include the antiforgery token header named "RequestVerificationToken"
    // which we read from the hidden input generated by @Html.AntiForgeryToken().

    const useAjax = false; // change to `true` if you want AJAX submit

    if (!useAjax) {
        // nothing to do — allow normal POST
        form.addEventListener('submit', function () {
            console.log('Submitting form via normal POST (server-side).');
        });
        return;
    }

    // ---------- AJAX path (if enabled) ----------
    form.addEventListener('submit', async function (e) {
        e.preventDefault();

        const url = form.action || window.location.href;
        const tokenEl = document.querySelector('input[name="__RequestVerificationToken"]');
        const token = tokenEl ? tokenEl.value : null;

        const fd = new FormData(form);

        try {
            const res = await fetch(url, {
                method: 'POST',
                headers: token ? { 'RequestVerificationToken': token } : {},
                body: fd,
                credentials: 'same-origin'
            });

            if (res.redirected) {
                // likely a successful save that redirected to Index
                window.location.href = res.url;
                return;
            }

            // If server returned 200 HTML (ModelState errors), replace body of form (or reload)
            if (res.ok) {
                const text = await res.text();
                // Simple approach: reload page (server will render ModelState errors)
                // Or replace the form container with returned HTML snippet if you implement partial responses.
                document.open();
                document.write(text);
                document.close();
            } else {
                alert('Failed to update. Server returned ' + res.status);
            }
        } catch (err) {
            console.error('AJAX submit failed', err);
            alert('Failed to submit form. See console for details.');
        }
    });
})();
