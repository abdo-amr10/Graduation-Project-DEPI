@model List<My_Uni_Hub.Models.Pages.Opportunity>

@{
    Layout = null;
    var jobs = Model ?? new List<My_Uni_Hub.Models.Pages.Opportunity>();
}
@{
    var featured = jobs.OrderByDescending(j => j.PostedAt).FirstOrDefault();
}


<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>MyUni Hub - Internships &amp; Jobs</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

    <style>
        /* Reset & base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;
            background: linear-gradient(135deg,#f5f7fa,#e8ecf1);
            color: #222;
            min-height: 100vh
        }

        .container {
            display: flex;
            min-height: 100vh
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 70px;
            background: #0b1a3d;
            border-radius: 0 25px 0 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 0;
            box-shadow: 3px 0 10px rgba(0,0,0,.12);
            transition: width .3s
        }

            .sidebar.expanded, .sidebar:hover {
                width: 230px;
                align-items: flex-start;
                padding-left: 18px;
                box-shadow: 10px 0 30px rgba(2,6,23,.18)
            }

        .logo-section {
            margin-bottom: 35px
        }

        .logo-img {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            object-fit: cover
        }

        .logo-text {
            display: none;
            color: #ffffff;
            font-weight: 700;
            font-size: 16px
        }

        .sidebar.expanded .logo-text, .sidebar:hover .logo-text {
            display: inline-block
        }

        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            flex-grow: 1;
            width: 100%;
            padding-top: 8px
        }

        .bottom-menu {
            margin-top: auto;
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center
        }

        .nav-item {
            color: #bfc8da;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 8px 0;
            border-radius: 10px;
            justify-content: center
        }

        .sidebar.expanded .nav-item {
            justify-content: flex-start;
            padding-left: 12px
        }

        .nav-item i {
            width: 36px;
            text-align: center;
            font-size: 18px
        }

        .nav-label {
            color: #bfc8da;
            font-size: 15px;
            white-space: nowrap;
            display: none;
            opacity: 0;
            transform: translateX(-6px);
            transition: opacity .2s,transform .2s
        }

        .sidebar.expanded .nav-label, .sidebar:hover .nav-label {
            display: inline-block;
            opacity: 1;
            transform: translateX(0)
        }

        .nav-item.active, .nav-item:hover {
            color: #ff8c00;
            background: rgba(255,140,0,.06)
        }

        /* Main */
        .main {
            margin-left: 75px;
            padding: 22px;
            transition: margin-left .25s
        }

        .sidebar.expanded ~ .main, .sidebar:hover ~ .main {
            margin-left: 230px
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px
        }

        .page-title {
            font-size: 26px;
            font-weight: 700;
            color: #2c3e50
        }

        .controls {
            display: flex;
            gap: 10px;
            align-items: center
        }

        .search {
            padding: 8px 10px;
            border-radius: 10px;
            border: 1px solid rgba(10,35,70,0.08);
            background: linear-gradient(180deg,#fbfdff,#f3f8ff);
            min-width: 220px
        }

        .btn {
            padding: 8px 12px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(180deg,#fff4e6,#fff0de);
            color: #b44b00;
            cursor: pointer
        }

        /* Cards & layout */
        .grid {
            display: grid;
            grid-template-columns: repeat(3,1fr);
            gap: 18px
        }

        .featured {
            background: linear-gradient(90deg,#fff8ef,#fff4e6);
            border-radius: 14px;
            padding: 18px;
            margin-bottom: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center
        }

        .badge {
            display: inline-block;
            background: #fff4e6;
            color: #b44b00;
            padding: 6px 8px;
            border-radius: 8px;
            font-weight: 700;
            margin-right: 8px
        }

        .card {
            background: #fff;
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.06)
        }

        .meta {
            font-size: 13px;
            color: #7f8c8d;
            margin-bottom: 8px
        }

        .title {
            font-size: 16px;
            font-weight: 700;
            color: #063055;
            margin-bottom: 10px;
            cursor: pointer
        }

        .excerpt {
            color: #334155;
            font-size: 14px;
            line-height: 1.45;
            margin-bottom: 10px
        }

        .apply-link {
            display: inline-block;
            padding: 8px 12px;
            border-radius: 10px;
            background: linear-gradient(90deg,#06b6d4,#3b82f6);
            color: #fff;
            text-decoration: none
        }

        .side-right {
            display: flex;
            flex-direction: column;
            gap: 18px
        }

        .widget {
            background: #fff;
            padding: 16px;
            border-radius: 14px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06)
        }

        /* responsive (escaped for Razor) */
        @@media (max-width:1100px) {
            .grid {
                grid-template-columns: repeat(2,1fr)
            }

            .side-right {
                width: 100%
            }
        }

        @@media (max-width:700px) {
            .grid {
                grid-template-columns: 1fr
            }

            .main {
                margin-left: 0
            }

            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
                border-radius: 0 0 12px 12px
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar" id="leftSidebar" aria-label="Main navigation">
            <div class="logo-section">
                    <img src="~/images/logo.png" class="logo-img" alt="MyUni Hub logo" />
                </a>
            </div>

            <nav class="nav-wrap" aria-label="Primary">
                <ul class="nav-menu" role="menu">
                    <li class="nav-item" role="menuitem" data-key="home" data-href="user/dashboard"><i class="fas fa-home"></i><span class="nav-label">Home</span></li>
                    <li class="nav-item" role="menuitem" data-key="profile" data-href="user/profile"><i class="fas fa-user"></i><span class="nav-label">Profile</span></li>
                    <li class="nav-item" role="menuitem" data-key="mycourses" data-href="user/courses"><i class="fas fa-book"></i><span class="nav-label">My Courses</span></li>
                    <li class="nav-item" role="menuitem" data-key="announcements" data-href="/announcements"><i class="fas fa-bullhorn"></i><span class="nav-label">Announcements</span></li>
                    <li class="nav-item" role="menuitem" data-key="chat" data-href="user/chat"><i class="fas fa-comments"></i><span class="nav-label">Chat</span></li>
                    <li class="nav-item" role="menuitem" data-key="agenda" data-href="/useragenda"><i class="fas fa-calendar-alt"></i><span class="nav-label">Agenda</span></li>
                    <li class="nav-item" role="menuitem" data-key="opportunities" data-href="/opportunities"><i class="fas fa-briefcase"></i><span class="nav-label">Opportunities</span></li>
                    <li class="nav-item" role="menuitem" data-key="lostfound" data-href="/lost-and-found"><i class="fas fa-box-open"></i><span class="nav-label">Lost &amp; Found</span></li>
                </ul>
            </nav>

            <ul class="bottom-menu" role="menu">
                <li class="nav-item" role="menuitem" data-key="settings" data-href="user/profile"><i class="fas fa-cog"></i><span class="nav-label">Settings</span></li>
                <li class="nav-item"
                    role="menuitem"
                    data-key="logout"
                    onclick="document.getElementById('logoutForm').submit();"
                    style="cursor:pointer;">
                    <i class="fas fa-sign-out-alt"></i><span class="nav-label">Logout</span>
                </li>
            </ul>
        </aside>

        <main class="main" id="mainContent" role="main">
            <div class="header">
                <div class="page-title">Internships &amp; Jobs</div>
                <div class="controls">
                    <input id="q" class="search" placeholder="Search internships, companies..." aria-label="Search opportunities" />
                </div>
            </div>

<div style="display:grid;grid-template-columns:2.5fr 1fr;gap:18px;align-items:start">
                <section>
                   <div class="featured" id="featured">
    @if (featured != null)
    {
        <div>
            <div class="badge">Featured</div>
            <div style="font-size:18px;font-weight:800;color:#063055">
                @Html.DisplayFor(m => featured.Title)
            </div>
            <div style="color:#6b7280;margin-top:6px">
                @{
                    // اقتطاع عند 140 حرف لو طويل
                    var desc = (featured.Description ?? "").Trim();
                    var shortDesc = desc.Length > 140 ? desc.Substring(0, 140).TrimEnd() + "…" : desc;
                }
                @Html.Raw(Html.Encode(shortDesc))
            </div>
        </div>

        <div style="text-align:right">
            <div style="font-weight:700;color:#063055">Apply before</div>
            <div style="color:#6b7280">
                @((featured.PostedAt).AddDays(30).ToString("yyyy-MM-dd"))
            </div>
            <a href="@(string.IsNullOrWhiteSpace(featured.ApplyLink) ? "#" : featured.ApplyLink)" 
               class="apply-link" style="display:inline-block;margin-top:10px" target="_blank" rel="noopener noreferrer">
                Apply
            </a>
        </div>
    }
    else
    {
        <div>
            <div class="badge">Featured</div>
            <div style="font-size:18px;font-weight:800;color:#063055">No featured opportunities yet</div>
            <div style="color:#6b7280;margin-top:6px">There are no opportunities to show right now.</div>
        </div>

        <div style="text-align:right">
            <div style="font-weight:700;color:#063055">Apply before</div>
            <div style="color:#6b7280">—</div>
            <a class="apply-link" style="display:inline-block;margin-top:10px" href="#">Apply</a>
        </div>
    }
</div>


                    <div class="grid" id="jobsList" aria-live="polite">
                        @foreach (var j in jobs)
                        {
                            <article class="card job-card" data-id="@j.OpportunityId" data-title="@j.Title">
                                <div class="meta">@j.Organization • @j.PostedAt.ToString("yyyy-MM-dd")</div>
                                <div class="title" data-id="@j.OpportunityId">@j.Title</div>
                                <div class="excerpt">@j.Description</div>
                                <div class="job-actions" style="margin-top:12px">
                                    <a href="@j.ApplyLink" target="_blank" rel="noopener noreferrer" class="apply-link">Apply</a>
                                </div>
                            </article>
                        }
                    </div>

                    <div style="margin-top:12px;color:#6b7280">Total openings: <span id="count">@jobs.Count</span></div>
                </section>

                <aside class="side-right">
                    <div class="widget">
                        <h3>Top Companies</h3>
                        <ul style="list-style:none;padding:0;margin:0">
                            @foreach (var g in jobs.GroupBy(x => x.Organization).Take(5))
                            {
                                <li style="padding:8px 0;border-bottom:1px dashed rgba(10,35,70,0.04)"><strong>@g.Key</strong><div style="font-size:13px;color:#6b7280">@g.Count() open</div></li>
                            }
                        </ul>
                    </div>

                    <div class="widget">
                        <h3>Info</h3>
                        <p style="color:#334155">Click <strong>Apply</strong> to open the external application link. Opportunities are read-only for users.</p>
                    </div>
                </aside>
            </div>
        </main>
    </div>

    <!-- Modal -->
    <div id="modal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.45);z-index:2000" role="dialog" aria-modal="true" aria-hidden="true">
        <div style="background:#fff;padding:18px;border-radius:12px;max-width:760px;width:95%">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                <strong id="modalTitle"></strong>
                <button id="closeModal" style="background:#f3f4f6;border:0;padding:6px 8px;border-radius:8px;cursor:pointer">Close</button>
            </div>
            <div id="modalContent" style="line-height:1.6"></div>
        </div>
    </div>

    <script>
        (function () {
            const qInput = document.getElementById('q') || document.querySelector('.search');
            const modal = document.getElementById('modal');
            const closeModal = document.getElementById('closeModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');

            // Modal open on title click
            document.body.addEventListener('click', function (e) {
                const titleEl = e.target.closest('.title');
                if (titleEl) {
                    const card = titleEl.closest('.job-card');
                    if (!card) return;
                    const title = titleEl.textContent.trim();
                    const excerpt = card.querySelector('.excerpt') ? card.querySelector('.excerpt').textContent : '';
                    const apply = card.querySelector('.apply-link') ? card.querySelector('.apply-link').href : '#';

                    modalTitle.textContent = title + (card.querySelector('.meta') ? ' — ' + card.querySelector('.meta').textContent.split('•')[0].trim() : '');
                    modalContent.innerHTML = '<p>' + escapeHtml(excerpt) + '</p><p style="margin-top:12px"><a class="apply-link" href="' + apply + '" target="_blank" rel="noopener noreferrer">Apply Now</a></p>';
                    modal.style.display = 'flex';
                    modal.setAttribute('aria-hidden', 'false');
                }
            });

            if (closeModal) closeModal.addEventListener('click', function () { modal.style.display = 'none'; modal.setAttribute('aria-hidden', 'true'); });
            window.addEventListener('click', function (e) { if (e.target === modal) { modal.style.display = 'none'; modal.setAttribute('aria-hidden', 'true'); } });

            // Search filter (client-side)
            if (qInput) {
                qInput.addEventListener('input', function (e) {
                    const q = (e.target.value || '').trim().toLowerCase();
                    filterByQuery(q);
                });
            }

            function filterByQuery(q) {
                const cards = Array.from(document.querySelectorAll('.job-card'));
                if (!q) { cards.forEach(c => c.style.display = ''); return; }
                cards.forEach(c => {
                    const title = (c.querySelector('.title')?.textContent || '').toLowerCase();
                    const org = (c.querySelector('.meta')?.textContent || '').toLowerCase();
                    const excerpt = (c.querySelector('.excerpt')?.textContent || '').toLowerCase();
                    const show = title.includes(q) || org.includes(q) || excerpt.includes(q);
                    c.style.display = show ? '' : 'none';
                });
            }

            function escapeHtml(text) {
                return String(text || '').replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            }

            // Sidebar interactions + active state
            (function initSidebar() {
                const sidebar = document.getElementById('leftSidebar');
                if (!sidebar) return;
                sidebar.addEventListener('mouseenter', () => sidebar.classList.add('expanded'));
                sidebar.addEventListener('mouseleave', () => sidebar.classList.remove('expanded'));

                const items = Array.from(sidebar.querySelectorAll('.nav-item'));
                function baseName(h) { if (!h) return ''; return h.split('#')[0].split('/').pop().split('?')[0]; }
                const current = (location.pathname.split('/').pop() || '').toLowerCase();

                items.forEach(i => {
                    const href = i.dataset.href;
                    const labelEl = i.querySelector('.nav-label');
                    if (labelEl) i.setAttribute('title', labelEl.textContent.trim());
                    if (href) {
                        i.setAttribute('role', 'link');
                        i.addEventListener('click', () => {
                                        if (key === "logout") return;

                            window.location.href = href; });
                        const target = baseName(href).toLowerCase();
                        if (target && target === current) { i.classList.add('active'); }
                    }
                });
            })();
        })();
    </script>
    <script>
(function () {
    // كل عناصر السايدبار
    const items = document.querySelectorAll('.nav-item');

    // ابعت المسار الحقيقي للصفحة بدون / في الآخر
    const current = window.location.pathname.replace(/\/$/, "").toLowerCase();

    // شيل active من الكل
    items.forEach(i => i.classList.remove("active"));

    let matched = null;

    // 1) أولاً — طابق link كامل مع data-href
    items.forEach(i => {
        const href = i.dataset.href;
        if (!href) return;

        try {
            // نحلل الرابط لحماية من الروابط المطلقة
            const a = document.createElement("a");
            a.href = href;
            const path = a.pathname.replace(/\/$/, "").toLowerCase();

            if (path === current) matched = i;
        } catch { }
    });

    // 2) لو لسه ملقاش — طابق آخر جزء مع الـ data-key
    if (!matched) {
        const last = current.split("/").pop();
        matched = Array.from(items).find(i =>
            (i.dataset.key || "").toLowerCase() === last
        );
    }

    // 3) لو لسه — طابق بادئة (لصفحات الأقسام مثل /opportunities/5/edit)
    if (!matched) {
        matched = Array.from(items).find(i => {
            const href = i.dataset.href;
            if (!href) return false;

            const a = document.createElement("a");
            a.href = href;
            const path = a.pathname.replace(/\/$/, "").toLowerCase();

            return current.startsWith(path);
        });
    }

    // لو وجدنا العنصر — فعّله
    if (matched) matched.classList.add("active");

})();
</script>
    <form id="logoutForm" method="post" action="/Auth/Logout" style="display:none;">
        @Html.AntiForgeryToken()
    </form>

</body>
</html> 

