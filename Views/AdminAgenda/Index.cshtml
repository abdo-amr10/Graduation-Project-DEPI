@model List<My_Uni_Hub.Models.Pages.UniversityAgenda>
@using My_Uni_Hub.Models.Pages

@{
ViewData["Title"] = "Agenda";
Layout = "_AdminLayout";
}

<style>
    body {     background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
    color: #1d1d1f; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; color: #fff; }
    .agenda-container { padding: 40px; max-width: 1250px; margin: auto; }

    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    .page-header h1 { font-size: 36px; font-weight: 600; background: #14243d; -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

    .btn-create {
        background: #14243d;
        padding: 10px 18px;
        border-radius: 10px;
        color: white;
        font-weight: 600;
        text-decoration: none;
        transition: 0.3s;
    }
    .btn-create:hover { background: #005fcc; }

    #calendar { background: white; color: black; border-radius: 15px; margin-bottom: 40px; padding: 15px; }

    .agenda-event {
        background: #14243d;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .agenda-event h2 { margin: 0; font-size: 20px; }

    /* ---- New Button Styles ---- */
    .btn {
        padding: 8px 14px;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        text-decoration: none;
        transition: 0.2s;
    }

    .btn-view { background: #17a2b8; color: white; }
    .btn-edit { background: #ffffff; color: black; }
    .btn-del { background: #dc3545; color: white; }

    .btn-view:hover { background: #117a8b; }
    .btn-edit:hover { background: #e0a800; }
    .btn-del:hover { background: #bd2130; }
</style>

<div class="agenda-container">

<div class="page-header">
    <h1>Agenda</h1>
    <a asp-controller="AdminAgenda" asp-action="Create" class="btn-create">+ Add Event</a>
</div>

<div id="calendar"></div>

<h2 style="margin-bottom:20px; color: #14243d; ">All Events</h2>

@if (Model != null && Model.Any())
{
    @foreach (var evt in Model)
    {
        <div class="agenda-event">
            <div>
                <h2>@evt.Title</h2>
                <p>
                    <b>Start:</b> @evt.StartDate.ToString("yyyy-MM-dd HH:mm") <br />
                    <b>End:</b> @evt.EndDate.ToString("yyyy-MM-dd HH:mm") <br />
                    <b>Type:</b> @evt.Type
                </p>
            </div>

            <div class="event-actions">

                <a asp-controller="AdminAgenda" asp-action="Details" asp-route-id="@evt.Id" class="btn btn-view">
                    👁️ View
                </a>

                <a asp-controller="AdminAgenda" asp-action="Edit" asp-route-id="@evt.Id" class="btn btn-edit">
                    ✏️ Edit
                </a>

                <form asp-controller="AdminAgenda" asp-action="DeleteConfirmed"
                      asp-route-id="@evt.Id" method="post" style="display:inline;"
                      onsubmit="return confirm('Are you sure you want to delete this event?');">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-del">🗑️ Delete</button>
                </form>

            </div>
        </div>
    }
}
else
{
    <p>No events found.</p>
}


</div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
var events = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(
    (Model ?? new List<UniversityAgenda>()).Select(e => new {
        title = e.Title,
        start = e.StartDate.ToString("yyyy-MM-ddTHH:mm"),
        end = e.EndDate.ToString("yyyy-MM-ddTHH:mm"),
        url = "/admin/agenda/details/" + e.Id
    })
));


        var calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
            initialView: 'dayGridMonth',
            height: "auto",
            events: events,
            eventClick: function (info) {
                window.location.href = info.event.url;
            }
        });

        calendar.render();
    });
</script>
